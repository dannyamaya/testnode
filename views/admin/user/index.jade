extend ../layout
block content
    .col-xs-12
        .panel.panel-default.col-xs-12
            form.form.col-xs-12.col-sm-4.no-padding#searchform(method="post" action="users")
                .input-group.search
                    input.form-control#search(type="text" aria-label="Buscar")
                    span.input-group-addon
                        i.fa.fa-search

            button.btn.btn-default.btn-adduser(data-toggle="tooltip" data-placement="top" title="Eliminar" onclick='deleteUserModal()')
                i.fa.fa-trash
            button.btn.btn-default.btn-adduser(data-toggle="tooltip" data-placement="top" title="Editar" onclick='updateUserModal()')
                i.fa.fa-pencil-square-o
            a.btn.btn-default.btn-adduser(href="/users/export" target="_blank" data-toggle="tooltip" data-placement="top" title="Descargar")
                i.fa.fa-download
            .pull-right
                button.btn.btn-livinn.btn-adduser(data-toggle="modal", data-target="#registrationModal", href="/#",data-dismiss="modal")
                    span.hidden-xs Add User
                    i.visible-xs.fa.fa-plus
            .clearfix
            .table-responsive.panel-user
                table.table.table-striped.hidden#userstable
                    thead
                        tr
                            th
                            th Email
                            th First Name
                            th Last Name
                            th Document
                            th Cellphone
                            th Role
                            th City
                            th Created
                            th Updated
                            th Last Login
                    tbody
                #loader
                .col-xs-12
                    p.text-center#pages 1-10 de # Users
                nav#page-nav
                    .text-center#page-selection

    <!-- User Read Modal -->
    .modal.fade#readModal(tabindex="-1", role="dialog", aria-labelledby="myModalLabel", aria-hidden="true")
        .modal-dialog.modal-lg
            .modal-content
                .modal-header
                    button.close(type="button", data-dismiss="modal", aria-hidden="true") &times;
                    h3.modal-title.text-center.readModalTitle
                .modal-body
                    .row
                        .col-xs-12.col-sm-10.col-sm-offset-1
                                .col-sm-12
                                    .form-group.emailregistrationerror.col-sm-4
                                        label(for='email') Email
                                        input#emailRead.form-control(type='text' placeholder='Email' name="email"  autofocus='' disabled)
                                    .form-group.col-sm-4
                                        label(for='first') First Name
                                        input#firstRead.form-control(type='text' name='first' placeholder='First Name' disabled autofocus='')
                                    .form-group.col-sm-4
                                        label(for='last') Last Name
                                        input#lastRead.form-control(type='text' name='last' placeholder='Last Name' disabled autofocus='')
                                .col-sm-12
                                    .form-group.col-sm-4
                                        label Type of Document
                                        .select
                                            select#doctypeRead(name="doctype" disabled)
                                                option(value="DNI") DNI
                                                option(value="Passport") Passport
                                    .form-group.col-sm-4
                                        label(for='document') Document
                                        input#documentRead.form-control(type='text' name='document' placeholder='Document' disabled autofocus='')
                                    .form-group.col-sm-4
                                        label(for='phone') Phone
                                        input#phoneRead.form-control(type='text' name='phone' placeholder='Phone' disabled autofocus='')
                                .col-sm-12
                                    .form-group.col-sm-4
                                        label Role
                                        .select
                                            select#roleRead(name="role" disabled)
                                                option(value="resident") Resident
                                                option(value="marketing") Marketing
                                                option(value="operation-manager") Operation Manager
                                                option(value="maintenance") Maintenance
                                                option(value="client-service") Client Service
                                                option(value="resident-assistant") Resident Assistant
                                                option(value="admin") Super Admin
                                    .form-group.col-sm-4
                                        label Location
                                        .select
                                            select#locationRead(name="location" disabled)
                                                option(value="Lord Cochrane Santiago") Lord Cochrane Santiago
                                                option(value="Viña Del Mar") Viña Del Mar
                                                option(value="Calle 18 Bogotá") Calle 18 Bogotá
                                                option(value="Calle 21 Bogotá")  Calle 21 Bogotá
                                                option(value="Villa Campestre Barranquilla") Villa Campestre Barranquilla
                                    .form-group.col-sm-4
                                        label Time Zone
                                        .select
                                            select#timezoneRead(name="timezone" disabled)
                                                option(value="América/Santiago") América/Santiago
                                                option(value="América/Bogotá") América/Bogotá
                                    .differentResident
                                        .form-group.col-sm-4
                                            label(for='occupation') Ocuppation
                                            input#occupationRead.form-control(type='text' name='occupation' placeholder='Occupation' disabled  autofocus='')
                                        .form-group.col-sm-4
                                            label(for='skype') Skype
                                            input#skypeRead.form-control(type='text' name='skype' placeholder='Skype' disabled autofocus='')


                                .col-sm-12.residentFields
                                    br
                                    h3.modal-title.text-center Resident Aditional Fields
                                    br
                                    .col-sm-12

                                        .form-group.col-sm-4
                                            label(for='numcontract') Contract Number
                                            input#numcontractRead.form-control(type='text' placeholder='Contract Number' name="numcontract" disabled autofocus='')
                                        .form-group.col-sm-4
                                            label(for='birthdate') Birth Date
                                            input#birthdateRead.form-control(type='date' name='birth_date' placeholder='Birth Date' disabled  autofocus='')
                                        .form-group.col-sm-4
                                            label(for='apartment') Apartment
                                            input#apartmentRead.form-control(type='text' name='apartment' placeholder='Apartment' disabled  autofocus='')
                                    .col-sm-12
                                        .form-group.col-sm-4
                                            label(for='type') Apartment Type
                                            input#typeRead.form-control(type='text' name='apartmentType' placeholder='Type' disabled  autofocus='')
                                        .form-group.col-sm-4
                                            label Bathroom
                                            .select
                                                select#bathroomRead(name="bathroom" disabled)
                                                    option(value="single") Single
                                                    option(value="shared") Shared
                                        .form-group.col-sm-4
                                            label(for='bed') Bed
                                            input#bedRead.form-control(type='text' name='bed' placeholder='Bed' disabled autofocus='')
                                    .col-sm-12
                                        .form-group.col-sm-4
                                            label(for='rate') Rate
                                            input#rateRead.form-control(type='text' name='rate' placeholder='Rate' disabled autofocus='')
                                        .form-group.col-sm-4
                                            label(for='currency') Currency
                                            input#currencyRead.form-control(type='text' name='currency' placeholder='Currency' disabled autofocus='')
                                        .form-group.col-sm-4
                                            label(for='rateusd') Rate USD
                                            input#rateusdRead.form-control(type='text' name='rateusd' placeholder='Rate USD' disabled autofocus='')
                                    .col-sm-12
                                        .form-group.col-sm-4
                                            label(for='rate') Agent
                                            input#agentRead.form-control(type='text' name='agent' placeholder='Agent' disabled  autofocus='')
                                        .form-group.col-sm-4
                                            label(for='finish') Finish
                                            input#finishRead.form-control(type='date' name='finish' placeholder='Finish' disabled  autofocus='')
                                        .form-group.col-sm-4
                                            label(for='start') Start
                                            input#startRead.form-control(type='date' name='start' placeholder='Start' disabled autofocus='')
                                    .col-sm-12
                                        .form-group.col-sm-4
                                            label(for='duration') Duration
                                            input#durationRead.form-control(type='string' name='duration' placeholder='Duration' disabled autofocus='')
                                        .form-group.col-sm-4
                                            label Status
                                            .select
                                                select#statusRead(name="status" disabled)
                                                    option(value="Booked") Booked
                                                    option(value="In-house") In-house

    <!-- User Registration Modal -->
    .modal.fade#registrationModal(tabindex="-1", role="dialog", aria-labelledby="myModalLabel", aria-hidden="true")
        .modal-dialog.modal-lg
            .modal-content
                .modal-header
                    button.close(type="button", data-dismiss="modal", aria-hidden="true") &times;
                    h3.modal-title.text-center Register User
                .modal-body
                    .row
                        .col-xs-12.col-sm-10.col-sm-offset-1
                            form#registrationForm(action="/api/users", method="post", role="form")
                                .col-sm-12
                                    .form-group.emailregistrationerror.col-sm-4
                                        label(for='email') Email
                                        input#email.form-control(type='text' placeholder='Email' name="email" required autofocus='')
                                    .form-group.col-sm-4
                                        label(for='first') First Name
                                        input#first.form-control(type='text' name='first' placeholder='First Name' required='' autofocus='')
                                    .form-group.col-sm-4
                                        label(for='last') Last Name
                                        input#last.form-control(type='text' name='last' placeholder='Last Name' required='' autofocus='')
                                .col-sm-12
                                    .form-group.col-sm-4
                                        label Type of Document
                                        .select
                                            select(name="doctype")
                                                option(value="DNI") DNI
                                                option(value="Passport") Passport
                                    .form-group.col-sm-4
                                        label(for='document') Document
                                        input#document.form-control(type='text' name='document' placeholder='Document' required='' autofocus='')
                                    .form-group.col-sm-4
                                        label(for='phone') Phone
                                        input#phone.form-control(type='text' name='phone' placeholder='Phone' required='' autofocus='')
                                .col-sm-12
                                    .form-group.col-sm-4
                                        label Role
                                        .select
                                            select.roleSelect(name="role")
                                                option(value="resident") Resident
                                                option(value="marketing") Marketing
                                                option(value="operation-manager") Operation Manager
                                                option(value="maintenance") Maintenance
                                                option(value="client-service") Client Service
                                                option(value="resident-assistant") Resident Assistant
                                                option(value="admin") Super Admin
                                    .form-group.col-sm-4
                                        label Location
                                        .select
                                            select(name="location")
                                                option(value="Lord Cochrane Santiago") Lord Cochrane Santiago
                                                option(value="Viña Del Mar") Viña Del Mar
                                                option(value="Calle 18 Bogotá") Calle 18 Bogotá
                                                option(value="Calle 21 Bogotá")  Calle 21 Bogotá
                                                option(value="Villa Campestre Barranquilla") Villa Campestre Barranquilla
                                    .form-group.col-sm-4
                                        label Time Zone
                                        .select
                                            select(name="timezone")
                                                option(value="América/Santiago") América/Santiago
                                                option(value="América/Bogotá") América/Bogotá
                                    .differentResident
                                        .form-group.col-sm-4
                                            label(for='occupation') Ocuppation
                                            input#occupation.form-control(type='text' name='occupation' placeholder='Occupation'  autofocus='')
                                        .form-group.col-sm-4
                                            label(for='skype') Skype
                                            input#skype.form-control(type='text' name='skype' placeholder='Skype' autofocus='')


                                .col-sm-12.residentFields
                                    br
                                    h3.modal-title.text-center Resident Aditional Fields
                                    br
                                    .col-sm-12

                                        .form-group.col-sm-4
                                            label(for='numcontract') Contract Number
                                            input#numcontract.form-control(type='text' placeholder='Contract Number' name="numcontract" autofocus='')
                                        .form-group.col-sm-4
                                            label(for='birthdate') Birth Date
                                            input#birthdate.form-control(type='date' name='birth_date' placeholder='Birth Date'  autofocus='')
                                        .form-group.col-sm-4
                                            label(for='apartment') Apartment
                                            input#apartment.form-control(type='text' name='apartment' placeholder='Apartment'  autofocus='')
                                    .col-sm-12
                                        .form-group.col-sm-4
                                            label(for='type') Apartment Type
                                            input#type.form-control(type='text' name='apartmentType' placeholder='Type'  autofocus='')
                                        .form-group.col-sm-4
                                            label Bathroom
                                            .select
                                                select(name="bathroom")
                                                    option(value="single") Single
                                                    option(value="shared") Shared
                                        .form-group.col-sm-4
                                            label(for='bed') Bed
                                            input#bed.form-control(type='text' name='bed' placeholder='Bed' autofocus='')
                                    .col-sm-12
                                        .form-group.col-sm-4
                                            label(for='rate') Rate
                                            input#rate.form-control(type='text' name='rate' placeholder='Rate' autofocus='')
                                        .form-group.col-sm-4
                                            label(for='currency') Currency
                                            input#currency.form-control(type='text' name='currency' placeholder='Currency' autofocus='')
                                        .form-group.col-sm-4
                                            label(for='rateusd') Rate USD
                                            input#rateusd.form-control(type='text' name='rateusd' placeholder='Rate USD' autofocus='')
                                    .col-sm-12
                                        .form-group.col-sm-4
                                            label(for='rate') Agent
                                            input#agent.form-control(type='text' name='agent' placeholder='Agent'  autofocus='')
                                        .form-group.col-sm-4
                                            label(for='finish') Finish
                                            input#finish.form-control(type='date' name='finish' placeholder='Finish'  autofocus='')
                                        .form-group.col-sm-4
                                            label(for='start') Start
                                            input#start.form-control(type='date' name='start' placeholder='Start' autofocus='')
                                    .col-sm-12
                                        .form-group.col-sm-4
                                            label(for='duration') Duration
                                            input#duration.form-control(type='string' name='duration' placeholder='Duration'  autofocus='')
                                        .form-group.col-sm-4
                                            label Status
                                            .select
                                                select(name="status")
                                                    option(value="Booked") Booked
                                                    option(value="In-house") In-house

                                .form-group.col-sm-12
                                button.btn.btn-lg.btn-livinn.btn-block(type='submit') Register

    <!-- Update User Modal -->
    .modal.fade#updateUserModal(tabindex="-1", role="dialog", aria-labelledby="myModalLabel", aria-hidden="true")
        .modal-dialog.modal-lg
            .modal-content
                .modal-header
                    button.close(type="button", data-dismiss="modal", aria-hidden="true") &times;
                    h3.modal-sm-title.text-center#updateModal_h ¿Do you want to update this user?
                .modal-body
                    .row
                        .col-xs-12.col-sm-10.col-sm-offset-1
                            form#updateForm(action="" method="" role="form")

                                .col-sm-12
                                    .form-group.emailregistrationerror.col-sm-4
                                        label(for='inputUpdateEmail') Email
                                        input#inputUpdateEmail.form-control(type='text' placeholder='Email' name="email" required autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateFirstname') First Name
                                        input#inputUpdateFirstname.form-control(type='text' name='first' placeholder='First Name' required='' autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateLastname') Last Name
                                        input#inputUpdateLastname.form-control(type='text' name='last' placeholder='Last Name' required='' autofocus='')
                                .col-sm-12
                                    .form-group.col-sm-4
                                        label Type of Document
                                        .select
                                            select#inputUpdateDocType(name="doctype")
                                                option(value="DNI") DNI
                                                option(value="Passport") Passport
                                    .form-group.col-sm-4
                                        label(for='inputUpdateDoc') Document
                                        input#inputUpdateDoc.form-control(type='text' name='document' placeholder='Document' required='' autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdatePhone') Phone
                                        input#inputUpdatePhone.form-control(type='text' name='phone' placeholder='Phone' required='' autofocus='')
                                .col-sm-12
                                    .form-group.col-sm-4
                                        label Role
                                        .select
                                            select#inputUpdateRole.roleSelect(name="role")
                                                option(value="resident") Resident
                                                option(value="marketing") Marketing
                                                option(value="operation-manager") Operation Manager
                                                option(value="maintenance") Maintenance
                                                option(value="client-service") Client Service
                                                option(value="resident-assistant") Resident Assistant
                                                option(value="admin") Super Admin
                                    .form-group.col-sm-4
                                        label Location
                                        .select
                                            select#inputUpdateLocation(name="location")
                                                option(value="Lord Cochrane Santiago") Lord Cochrane Santiago
                                                option(value="Viña Del Mar") Viña Del Mar
                                                option(value="Calle 18 Bogotá") Calle 18 Bogotá
                                                option(value="Calle 21 Bogotá")  Calle 21 Bogotá
                                                option(value="Villa Campestre Barranquilla") Villa Campestre Barranquilla
                                    .form-group.col-sm-4
                                        label Time Zone
                                        .select
                                            select#inputUpdateTimeZone(name="timezone")
                                                option(value="América/Santiago") América/Santiago
                                                option(value="América/Bogotá") América/Bogotá
                                    .differentResident
                                        .form-group.col-sm-4
                                            label(for='inputUpdateOccupation') Ocuppation
                                            input#inputUpdateOccupation.form-control(type='text' name='occupation' placeholder='Occupation'  autofocus='')
                                        .form-group.col-sm-4
                                            label(for='inputUpdateSkype') Skype
                                            input#inputUpdateSkype.form-control(type='text' name='skype' placeholder='Skype' autofocus='')


                                .col-sm-12.residentFields
                                    br
                                    h3.modal-title.text-center Resident Aditional Fields
                                    br
                                    .form-group.col-sm-4
                                        label(for='inputUpdateContract') Contract Number
                                        input#inputUpdateContract.form-control(type='text' placeholder='Contract Number' name="numcontract" autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateBirthdate') Birth Date
                                        input#inputUpdateBirthdate.form-control(type='date' name='birthdate' placeholder='Birth Date'  autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateApartment') Apartment
                                        input#inputUpdateApartment.form-control(type='text' name='apartment' placeholder='Apartment'  autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateApartmentType') Type
                                        input#inputUpdateApartmentType.form-control(type='text' name='bedtype' placeholder='Type'  autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateBed') Bed
                                        input#inputUpdateBed.form-control(type='text' name='bed' placeholder='Bed' autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateRate') Rate
                                        input#inputUpdateRate.form-control(type='text' name='rate' placeholder='Rate' autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateCurrency') Currency
                                        input#inputUpdateCurrency.form-control(type='text' name='currency' placeholder='Currency' autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateRateusd') Rate USD
                                        input#inputUpdateRateusd.form-control(type='text' name='rateusd' placeholder='Rate USD' autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateAgent') Agent
                                        input#inputUpdateAgent.form-control(type='text' name='agent' placeholder='Agent'  autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateFinish') Finish
                                        input#inputUpdateFinish.form-control(type='date' name='finish' placeholder='Finish'  autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateStart') Start
                                        input#inputUpdateStart.form-control(type='date' name='start' placeholder='Start' autofocus='')
                                    .form-group.col-sm-4
                                        label(for='inputUpdateDuration') Duration
                                        input#inputUpdateDuration.form-control(type='string' name='duration' placeholder='Duration'  autofocus='')
                .modal-footer
                    button.btn.pull-right.deleteBtn(data-dismiss="modal" aria-hidden="true") Cancel
                    button.btn.btn-livinn(onclick='updateUser()')  Update

    <!-- Delete User Modal -->
    .modal.fade#deleteUserModal(tabindex="-1", role="dialog", aria-labelledby="myModalLabel", aria-hidden="true")
        .modal-dialog
            .modal-content
                .modal-header
                    button.close(type="button", data-dismiss="modal", aria-hidden="true") &times;
                    .row
                        .col-xs-4.col-xs-offset-4.no-padding
                            img.img-responsive(src="img/icon_eliminar.svg", alt="eliminar")
                        h3.col-xs-12.modal-title.text-center#deleteModal_h ¿Desea eliminar este usuario?
                .modal-body
                    h4.modal-title.text-danger.danger-modal.text-center.hidden#deleteError
                    form
                        p.text-center#deleteModal_p Toda la información de este usuario será eliminada del sistema.
                        br
                .modal-footer
                    a.btn.btn-danger.deleteBtn.btn-livinn(onclick='deleteUser()')  Eliminar
                    button.btn.pull-right.deleteBtn(data-dismiss="modal" aria-hidden="true") Cancelar


block scripts
    script(src="/js/jquery.bootpag.min.js")
    script.
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })

        $(document).ready(function () {

            $('#page-selection').bootpag({
                total: 10,
                maxVisible: 5,
            }).on("page", function (event, num) {
                console.log("numero:" + num);
                filterUsers(num);
            });

            filterUsers(1);
        });


        /*=== Create user ===*/
        $('#registrationForm').submit(function (evt) {
            console.log("Registro");
            evt.preventDefault();

            var url = $(this).attr("action");
            var formData = $(this).serialize();

            $.ajax({
                type: "POST",
                url: url,
                data: formData,
                success: function (response) {
                    if (response.status == '409') {
                        $('#inputEmail').focus();
                        $('.emailregistrationerror').addClass('has-error');
                        warningAlert('Ya existe una cuenta registrada con este Email o número de Documento');
                    } else {
                        $('#registrationModal').modal('hide');
                        console.log(response);
                        $('.residentFields').show();
                        document.getElementById("registrationForm").reset();
                        $("#userstable tbody").prepend("<tr class='hvr-grow-shadow'><td><input type='checkbox' value='" + response.users._id + "'></td><td>" + response.users.email + "</td><td class='text-capitalize'>" + response.users.name.first + "</td><td class='text-capitalize'>" + response.users.name.last + "</td><td>" + response.users.doc.number + "</td><td>" + response.users.phone.number + "</td><td>" + response.users.role + "</td><td>" + response.users.location + "</td><td>" + moment(response.users.created).format('YYYY-DD-MM-h:mm a') + "</td><td>" + moment(response.users.updated).format('YYYY-DD-MM-h:mm a') + "</td><td>" + moment(response.users.lastlogin).format('YYYY-DD-MM-h:mm a') + "</td></tr>");
                        successAlert("User created");
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    var message = XMLHttpRequest.responseJSON.message;
                    warningAlert(message);
                }
            });
        });

        /* Read users */
        function readUsers(page, search) {

            var p = page || 1;
            var s = search || '';

            var url = "/api/users?page=" + p + "&search=" + s;

            $.ajax({
                type: "GET",
                url: url,
                success: function (response) {
                    var total = parseInt(response.count / 10);
                    if (response.count % 10 != 0) {
                        total += 1;
                    }

                    var m = ((response.count % 10 != 0 && response.page == total) ? response.count % 10 : 10);

                    var a = 1 + (response.page - 1) * 10;
                    var b = m + (response.page - 1) * 10;
                    $('#pages').html(a + '-' + b + ' of ' + response.count + ' Users');
                    $('#page-selection').bootpag({total: total, maxVisible: 5});

                    var banned;
                    $("#userstable tbody tr").remove();
                    for (key = 0; key < response.users.length; key++) {

                        if (response.users[key].banned) {
                            banned = '<i class="fa fa-ban warning-color" aria-hidden="true"></i>';
                        } else {
                            banned = "";
                        }
                        var usd = ((response.users[key].usd) ? response.users[key].usd : 0);
                        var clp = ((response.users[key].clp) ? response.users[key].clp : 0);

                        $("#userstable tbody").prepend("<tr class='hvr-grow-shadow'><td><input type='checkbox' value='" + response.users[key]._id + "'></td><td>" + response.users[key].email + "</td><td class='text-capitalize'>" + response.users[key].name.first + "</td><td class='text-capitalize'>" + response.users[key].name.last + "</td><td>" + response.users[key].doc.number + "</td><td>" + response.users[key].phone.number + "</td><td>" + response.users[key].role + "</td><td>" + response.users[key].location + "</td><td>" + moment(response.users[key].created).format('YYYY-DD-MM-h:mm a') + "</td><td>" + moment(response.users[key].updated).format('YYYY-DD-MM-h:mm a') + "</td><td>" + moment(response.users[key].lastlogin).format('YYYY-DD-MM-h:mm a') + "</td></tr>");
                    }

                    $('#loader').fadeOut("slow", function () {
                        $('#userstable').removeClass("hidden").fadeIn("slow");
                    });

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    var message = XMLHttpRequest.responseJSON.message;
                    warningAlert(message);
                }
            });
        }

        /*=== Update user ==m=*/
        function updateUserModal() {
            document.getElementById("updateForm").reset();

            len = $('#userstable input:checkbox:checked').length;
            if (len == 0) {
                warningAlert('Please select one element for the update.');
            } else if (len == 1) {
                var id = $('input:checkbox:checked')[0].value;


                $.ajax({
                    type: "GET",
                    url: 'api/users/' + id,
                    success: function (response) {
                        $('#updateModal_h').html('¿Do you want to update the user <span class="text-capitalize">' + response.user.name.first + ' ' + response.user.name.last + '</span>?');
                        $("#inputUpdateEmail").val(response.user.email);
                        $("#inputUpdateFirstname").val(response.user.name.first);
                        $("#inputUpdateLastname").val(response.user.name.last);
                        $("#inputUpdateDocType").val(response.user.doc.typedoc);
                        $("#inputUpdateDoc").val(response.user.doc.number);
                        $("#inputUpdatePhone").val(response.user.phone.number);
                        $("#inputUpdateRole").val(response.user.role);
                        $("#inputUpdateLocation").val(response.user.location);
                        $("#inputUpdateTimeZone").val(response.user.time_zone);
                        $("#inputUpdateOccupation").val(response.user.occupation);
                        $("#inputUpdateSkype").val(response.user.skype);

                        if ($("#inputUpdateRole").val() === 'resident') {
                            $('.residentFields').show();
                            $('.differentResident').hide();


                            $.ajax({
                                type: "GET",
                                url: 'api/residents/' + id,
                                success: function (response) {
                                    $("#inputUpdateContract").val(response.resident.contract_number);
                                    $("#inputUpdateBirthdate").val(response.resident.birth_date.substr(0,10));
                                    $("#inputUpdateApartment").val(response.resident.apartment);
                                    $("#inputUpdateApartmentType").val(response.resident.apartment_type);
                                    $("#inputUpdateRate").val(response.resident.rate);
                                    $("#inputUpdateBed").val(response.resident.bed);
                                    $("#inputUpdateCurrency").val(response.resident.currency);
                                    $("#inputUpdateRateusd").val(response.resident.rateusd);
                                    $("#inputUpdateAgent").val(response.resident.agent);
                                    $("#inputUpdateFinish").val(response.resident.finish.substr(0,10));
                                    $("#inputUpdateStart").val(response.resident.start.substr(0,10));
                                    $("#inputUpdateDuration").val(response.resident.duration);

                                },
                                error: function (XMLHttpRequest, textStatus, errorThrown) {
                                    var message = XMLHttpRequest.responseJSON.message;
                                    warningAlert(message);
                                }
                            });
                        }else{
                            $('.residentFields').hide();
                            $('.differentResident').show();
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        var message = XMLHttpRequest.responseJSON.message;
                        warningAlert(message);
                    }
                });

                $('#updateUserModal').modal('show');
            }
            else {
                warningAlert('Only can update one user at time.');
            }
        }

        function updateUser() {

            var users = [];
            $('#userstable input:checkbox:checked').each(function () {
                users.push($(this).val());
            });

            var updatedata = $("#updateForm").serialize();
            $.ajax({
                type: "PUT",
                data: updatedata,
                url: '/api/users/' + users[0],
                success: function (response) {
                    console.log(response);
                    var userr;
                    $('input:checkbox:checked').each(function () {
                        userr = $(this).parents("tr");
                        $(this).attr('checked', false);
                    });

                    var tdEmail = userr.children("td:nth-child(2)");
                    var tdFirst = userr.children("td:nth-child(3)");
                    var tdLast = userr.children("td:nth-child(4)");
                    var tdDoc = userr.children("td:nth-child(5)");
                    var tdCellphone = userr.children("td:nth-child(6)");
                    var tdRol = userr.children("td:nth-child(7)");
                    var tdCity = userr.children("td:nth-child(8)");
                    var tdUpdated = userr.children("td:nth-child(10)");

                    tdEmail.text(response.user.email);
                    tdDoc.text(response.user.doc.number);
                    tdFirst.text(response.user.name.first);
                    tdLast.text(response.user.name.last);
                    tdCellphone.text(response.user.phone.number);
                    tdRol.text(response.user.rol);
                    tdCity.text(response.user.location);
                    tdUpdated.text(moment(response.user.updated).format('YYYY-DD-MM-h:mm a'));

                    $('#updateUserModal').modal('hide');

                    successAlert('Usuario ha sido modificado');
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    var message = XMLHttpRequest.responseJSON.message;
                    warningAlert(message);
                }
            });

        }

        /* Delete user */

        function deleteUserModal() {
            len = $('input:checkbox:checked').length;
            if (len == 0) {
                warningAlert('No has seleccionado ningun elemento para eliminar.');
            } else if (len == 1) {
                $('#deleteModal_h').html('').html('¿Desea eliminar este usuario?')
                $('#deleteModal_p').html('').html('Toda la información de este usuario será eliminada del sistema.');
                $('#deleteUserModal').modal('show');
            }
            else {
                $('#deleteModal_h').html('').html('¿Desea eliminar estos usuarios?')
                $('#deleteModal_p').html('').html('Toda la información de los usuarios seleccionados será eliminada del sistema.');
                $('#deleteUserModal').modal('show');
            }
        }

        function deleteUser() {

            var users = [];
            $('input:checkbox:checked').each(function () {
                users.push($(this).val());
            });

            $.ajax({
                type: "DELETE",
                data: {users: users},
                url: '/api/users',
                success: function (response) {
                    $('input:checkbox:checked').each(function () {
                        $(this).parents("tr").remove();
                    });
                    $('#deleteUserModal').modal('hide');
                    successAlert(message);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    var message = XMLHttpRequest.responseJSON.message;
                    warningAlert(message);
                }
            });

        }

        function filterUsers(page) {
            var search = $('#search').val().trim();
            readUsers(page, search);
        }

        /*Search user*/

        $('#searchform').submit(function (event) {

            event.preventDefault();

            $('#userstable').fadeOut("fast", function () {
                $('#loader').fadeIn("fast");
                readUsers(1, $("#search").val());
            });
        });

        $('.differentResident').hide();

        $('.roleSelect').on('change', function () {
            if (this.value != 'resident') {
                $('.differentResident').show();
                $('.residentFields').hide();
            }
            else {
                $('.differentResident').hide();
                $('.residentFields').show();
            }
        });

        $('table').on('dblclick','tr',function(){
            var id = $(this).children().children().val();

            $.ajax({
                type: "GET",
                url: 'api/users/' + id,
                success: function (response) {
                    $('.readModalTitle').html('<span class="text-capitalize">' + response.user.name.first + ' ' + response.user.name.last + '</span>');
                    $("#emailRead").val(response.user.email);
                    $("#firstRead").val(response.user.name.first);
                    $("#lastRead").val(response.user.name.last);
                    $("#doctypeRead").val(response.user.doc.typedoc);
                    $("#documentRead").val(response.user.doc.number);
                    $("#phoneRead").val(response.user.phone.number);
                    $("#roleRead").val(response.user.role);
                    $("#locationRead").val(response.user.location);
                    $("#timezoneRead").val(response.user.time_zone);
                    $("#occupationRead").val(response.user.occupation);
                    $("#skypeRead").val(response.user.skype);

                    if ($("#roleRead").val() === 'resident') {
                        $('.residentFields').show();
                        $('.differentResident').hide();


                        $.ajax({
                            type: "GET",
                            url: 'api/residents/' + id,
                            success: function (response) {
                                $("#numcontractRead").val(response.resident.contract_number);
                                $("#birthdateRead").val(response.resident.birth_date.substr(0, 10));
                                $("#apartmentRead").val(response.resident.apartment);
                                $("#typeRead").val(response.resident.apartment_type);
                                $("#rateRead").val(response.resident.rate);
                                $("#bathroomRead").val(response.resident.bathroom);
                                $("#bedRead").val(response.resident.bed);
                                $("#currencyRead").val(response.resident.currency);
                                $("#rateusdRead").val(response.resident.rateusd);
                                $("#agentRead").val(response.resident.agent);
                                $("#finishRead").val(response.resident.finish.substr(0, 10));
                                $("#startRead").val(response.resident.start.substr(0, 10));
                                $("#durationRead").val(response.resident.duration);

                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                                var message = XMLHttpRequest.responseJSON.message;
                                warningAlert(message);
                            }
                        });
                    } else {
                        $('.residentFields').hide();
                        $('.differentResident').show();
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    var message = XMLHttpRequest.responseJSON.message;
                    warningAlert(message);
                }
            });

            $('#readModal').modal('show');

        });



